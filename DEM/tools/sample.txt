###################################Header for General commands#######################################################

atom_style	granular		#Simulation of particles

boundary	f f f			#fixed boundaries -> particles will be deleted if leaving the simulation box

units		cgs

communicate	single vel yes	#default

newton		off				#default


region		reg block  0.0 0.1 0.0 0.1  0.0 0.15 units box
create_box	2 reg

neighbor	0.01 bin
neigh_modify	delay 0

variable natoms equal 2 	#1 -> particle #2->Die

####variable for material properties####

####Young Modulus####
variable	youngmodulus1	equal 	5.e9		#
variable	youngmodulus2	equal 	5.e9		#

####Poission ratio####
variable 	poission1	equal	0.4
variable 	poission2	equal	0.4

####variable for contact properties####

####coefficient of restitution####
variable	CoR11	equal	0.5
variable	CoR12	equal	0.5
variable	CoR21	equal	0.5
variable	CoR22	equal	0.5

####sliding friction coefficient####
variable	sf11	equal	0.7
variable	sf12	equal	0.7
variable	sf21	equal	0.7
variable	sf22	equal	0.0

####rolling friction coefficient####
variable	rf11	equal	0.05
variable	rf12	equal	0.05
variable	rf21	equal	0.05
variable	rf22	equal	0.05

#Material properties required for new pair styles

fix 		m1 all property/global youngsModulus peratomtype ${youngmodulus1} ${youngmodulus2}

fix 		m2 all property/global poissonsRatio peratomtype ${poission1} ${poission2}

fix 		m3 all property/global coefficientRestitution peratomtypepair ${natoms} 0.5 0.5 0.5 0.5

fix 		m4 all property/global coefficientFriction peratomtypepair ${natoms} ${sf11} ${sf12} ${sf21} ${sf22}

fix 		m5 all property/global coefficientRollingFriction peratomtypepair ${natoms} ${rf11} ${rf12} ${rf21} ${rf22}


#New pair style
pair_style gran model hertz tangential history #Hertzian without cohesion
pair_coeff	* *


timestep	0.00001

####settle time####

variable	settletime	equal	0.1 #second

variable	settlesteps	equal	${settletime}/0.00001

fix		gravi all gravity 120000 vector 0.0 0.0 -1.0

#granular walls
fix     die all mesh/surface file meshes/Die.stl type 2 scale 0.1 

fix		insertionsface all mesh/surface/planar file meshes/Insertionsface.stl type 1  scale 0.1

fix wall all wall/gran model hertz tangential history mesh n_meshes 1 meshes die 


#distributions for insertion
fix		pts1 all particletemplate/sphere 15485863 atom_type 1 density constant 30000 radius constant 0.0035
fix		pdd1 all particledistribution/discrete 32452843 2 pts1 0.3
#region for insertion
group		nve_group region reg
region		bc block 0.0025 0.095 0.0025 0.095 0.1 0.1 units box


#particle insertion
fix			ins nve_group insert/stream seed 32452867 distributiontemplate pdd1 &
			maxattempt 1000 mass 150. massrate 5 overlapcheck yes vel constant 0. 0. -0.2&
			insertion_face insertionsface extrude_length 0.04

#apply nve integration to all particles that are inserted as single particles
fix		integr nve_group nve/sphere


#insert the first particles so that dump is not empty
run			1
dump		dmp all custom/vtk 200 DEM/generate_*.vtk id type type x y z ix iy iz vx vy vz fx fy fz mass radius 

#insert particles
run			50000 upto
unfix		ins
##################################RUN the simulation settling#############################################################

run	 ${settlesteps}


